<?xml version='1.0' encoding='windows-1252'?>
<!--
  Transmutation Windows Installer (WiX)
  Compatible with cargo-wix
-->

<Wix xmlns='http://schemas.microsoft.com/wix/2006/wi'>

  <Product
    Id='*'
    Name='Transmutation'
    UpgradeCode='12345678-1234-1234-1234-123456789012'
    Manufacturer='HiveLLM Team'
    Language='1033'
    Codepage='1252'
    Version='$(var.Version)'>

    <Package Id='*'
      Keywords='Installer'
      Description='High-performance document conversion engine for AI/LLM embeddings'
      Manufacturer='HiveLLM Team'
      InstallerVersion='450'
      Languages='1033'
      Compressed='yes'
      InstallScope='perMachine'
      SummaryCodepage='1252'
      Platform='x64' />

    <MajorUpgrade
      Schedule='afterInstallInitialize'
      DowngradeErrorMessage='A newer version of [ProductName] is already installed.' />

    <Media Id='1' Cabinet='media1.cab' EmbedCab='yes' />

    <Directory Id='TARGETDIR' Name='SourceDir'>
      <Directory Id='ProgramFiles64Folder'>
        <Directory Id='APPLICATIONFOLDER' Name='Transmutation'>
          
          <!-- Main executable -->
          <Component Id='MainExecutable' Guid='*' Win64='yes'>
            <File
              Id='TransmutationEXE'
              Name='transmutation.exe'
              Source='$(var.CargoTargetBinDir)\transmutation.exe'
              KeyPath='yes' />
            
            <Environment
              Id='PATH'
              Name='PATH'
              Value='[APPLICATIONFOLDER]'
              Permanent='no'
              Part='last'
              Action='set'
              System='yes' />
          </Component>

        </Directory>
      </Directory>

      <!-- Start Menu -->
      <Directory Id='ProgramMenuFolder'>
        <Directory Id='ApplicationProgramsFolder' Name='Transmutation'>
          <Component Id='ApplicationShortcut' Guid='*' Win64='yes'>
            <Shortcut
              Id='AppShortcut'
              Name='Transmutation'
              Target='[APPLICATIONFOLDER]transmutation.exe'
              WorkingDirectory='APPLICATIONFOLDER'
              Icon='TransmutationIcon' />
            <RemoveFolder Id='ApplicationProgramsFolder' On='uninstall' />
            <RegistryValue
              Root='HKCU'
              Key='Software\HiveLLM\Transmutation'
              Name='installed'
              Type='integer'
              Value='1'
              KeyPath='yes' />
          </Component>
        </Directory>
      </Directory>
    </Directory>

    <!-- Features -->
    <Feature
      Id='MainApplication'
      Title='Transmutation'
      Level='1'
      ConfigurableDirectory='APPLICATIONFOLDER'
      AllowAdvertise='no'>
      
      <ComponentRef Id='MainExecutable' />
      <ComponentRef Id='ApplicationShortcut' />
    </Feature>

    <!-- UI -->
    <UIRef Id='WixUI_InstallDir' />
    <Property Id='WIXUI_INSTALLDIR' Value='APPLICATIONFOLDER' />
    
    <!-- License Agreement -->
    <WixVariable Id='WixUILicenseRtf' Value='wix\License.rtf' />
    
    <!-- Application Icon -->
    <Icon Id='TransmutationIcon' SourceFile='wix\icon.ico' />
    <Property Id='ARPPRODUCTICON' Value='TransmutationIcon' />

  </Product>

</Wix>
